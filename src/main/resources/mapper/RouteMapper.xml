<?xml version="1.0" encoding="utf-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.metoo.nrsm.core.mapper.RouteTableMapper">

    <insert id="batchInsertRoutes">
        INSERT INTO metoo_route_table (time, deviceIp, destnetwork, mask, interface,port, nexthop, cost,preference,
        type)
        VALUES
        <foreach collection="routes" item="route" separator=",">
            (
            #{route.time},
            #{route.deviceIp},
            #{route.destnetwork},
            #{route.mask},
            #{route.interfaceName},
            #{route.port},
            #{route.nexthop},
            #{route.cost},
            #{route.preference},
            #{route.type}
            )
        </foreach>
    </insert>
    <insert id="copyDataToRouteHistory">
        INSERT INTO metoo_route_table_history
        SELECT *
        FROM metoo_route_table
    </insert>

    <select id="selectObjByDeviceUuid" resultType="com.metoo.nrsm.entity.RouteEntry">
        SELECT
        time,
        deviceIp,
        destnetwork,
        mask,
        interface AS interfaceName,
        port,
        nexthop,
        cost,
        preference,
        type
        FROM
        <choose>
            <!-- 当time参数存在且不为空时，查询历史表 -->
            <when test="time != null">
                metoo_route_table_history
            </when>
            <!-- 否则查询当前表 -->
            <otherwise>
                metoo_route_table
            </otherwise>
        </choose>
        WHERE deviceIp = #{deviceIp}
        <if test="time != null">
            AND time = #{time}
        </if>
        ORDER BY destnetwork
    </select>
</mapper>